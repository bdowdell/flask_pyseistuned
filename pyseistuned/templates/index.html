<!--
Copyright 2020, Benjamin L. Dowdell

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at:

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
{% extends 'base.html' %}
{% block head %}
    {{ super() }}
    <!-- enable bootstrap tooltip via Popper.js (already loaded in base.html) -->
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip({html: true})
        })
    </script>
    <!-- Style for bootstrap tooltip to align text left and set font size -->
    <style>
        .tooltip-inner {
            text-align: left;
            font-size: 12px;
        }
    </style>
    <script type="text/javascript">
        window.onload = function(){
            //check what the selected wavelet type is on load for displaying Ricker apparent frequency
            var state = document.getElementById('wvType');
            if( state.value == 1){
                $('#freqApp').hide();
            }
            else{
                $('#freqApp').show();
            }
            //calculate the Ricker apparent frequency on page load
            var fa = document.getElementById('freqApp');
            var fc = document.getElementById('freqC')
            if( fc.value != ''){
                fa.value = String(Math.round(((fc.value * (Math.PI / Math.sqrt(6))) + 0.00001) * 100) / 100) + " Hz";
            }
            else{
                fa.value = '';
            }
            //calculate layer impedances on page load
            var vp1 = document.getElementById('vp1');
            var rho1 = document.getElementById('rho1');
            var imp1 = document.getElementById('imp1');
            if( vp1.value != '' && rho1.value != ''){
                imp1.value = Math.round(vp1.value * rho1.value * 100) / 100;
            }
            else{
                imp1.value = '';
            }
            var vp2 = document.getElementById('vp2');
            var rho2 = document.getElementById('rho2');
            var imp2 = document.getElementById('imp2');
            if( vp2.value != '' && rho2.value != ''){
                imp2.value = Math.round(vp2.value * rho2.value * 100) / 100;
            }
            else{
                imp2.value = '';
            }
        }

        function toggleShowFApp() {
            var state = document.getElementById('wvType');
            if( state.value == 1){
                document.getElementById('freqC').value = '';
                $('#freqApp').hide();
                document.getElementById('freqApp').value = '';
            }
            else{
                document.getElementById('freqC').value = '';
                $('#freqApp').show();
                document.getElementById('freqApp').value = '';
            }
        }

        function updateApparentFrequency(fc) {
            var fa = document.getElementById('freqApp');
            if( fc.value != ''){
                fa.value = String(Math.round(((fc.value * (Math.PI / Math.sqrt(6))) + 0.00001) * 100) / 100) + " Hz";
            }
            else{
                fa.value = '';
            }
        }

        function updateAcousticImpedance() {
            var vp1 = document.getElementById('vp1');
            var rho1 = document.getElementById('rho1');
            var imp1 = document.getElementById('imp1');
            if( vp1.value != '' && rho1.value != ''){
                imp1.value = Math.round(vp1.value * rho1.value * 100) / 100;
            }
            else{
                imp1.value = '';
            }
            var vp2 = document.getElementById('vp2');
            var rho2 = document.getElementById('rho2');
            var imp2 = document.getElementById('imp2');
            if( vp2.value != '' && rho2.value != ''){
                imp2.value = Math.round(vp2.value * rho2.value * 100) / 100;
            }
            else{
                imp2.value = '';
            }
        }

        function resetForm(){
            document.getElementById('vp1').value = '';
            document.getElementById('rho1').value = '';
            document.getElementById('imp1').value = '';
            document.getElementById('vp2').value = '';
            document.getElementById('rho2').value = '';
            document.getElementById('imp2').value = '';
            document.getElementById('vp_units-0').checked = true;
            document.getElementById('wvType').value = 0;
            document.getElementById('freqC').value = '';
            document.getElementById('freqApp').value = '';
            document.getElementById('wvLen').value = 0.100;
            document.getElementById('wvdt').value = 0.001;
        }
    </script>
{% endblock %}
{% block content %}
    <h1>{% block title %} Welcome to PySeisTuned<sup>2.0</sup> {% endblock %}</h1>
    <p>
        Calculate seismic tuning on the web!
    </p>
    <!-- Tuning Wedge Inputs -->
    <form action="" method="post" novalidate>
        {{ form.hidden_tag() }}
        <!-- Rock Properties -->
        <div class="form-row">
            <div class="col-sm">
                <h4>Rock Property Parameters</h4>
                <div class="form-row row-cols-4">
                    <div class="col-sm"></div>
                    <div class="col-sm"><strong>Vp</strong></div>
                    <div class="col-sm"><strong>Density (g/cm<sup>3</sup>)</strong></div>
                    <div class="col-sm" style="color: grey;">Acoustic Impedance</div>
                </div>
                <div class="form-row row-cols-4">
                    <div class="col-sm">
                        Top & Base
                    </div>
                    <div class="col-sm">
                        {{ form.layer_1_vp(class_='form-control', id='vp1', oninput='updateAcousticImpedance()') }}
                        {% for error in form.layer_1_vp.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-sm">
                        {{ form.layer_1_dens(class_='form-control', id='rho1', oninput='updateAcousticImpedance()') }}
                        {% for error in form.layer_1_dens.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-sm">
                        {{ form.layer_1_impedance(class_='form-control-plaintext', id='imp1', placeholder='', readonly=true, tabindex='-1', style='color: grey;') }}
                    </div>
                </div>
                <div class="form-row row-cols-4">
                    <div class="col-sm">
                        Wedge
                    </div>
                    <div class="col-sm">
                        {{ form.layer_2_vp(class_='form-control', id='vp2', oninput='updateAcousticImpedance()') }}
                        {% for error in form.layer_2_vp.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-sm">
                        {{ form.layer_2_dens(class_='form-control', id='rho2', oninput='updateAcousticImpedance()') }}
                        {% for error in form.layer_2_dens.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-sm">
                        {{ form.layer_2_impedance(class_='form-control-plaintext', id='imp2', placeholder='', readonly=true, tabindex='-1', style='color: grey;') }}
                        {% for error in form.layer_2_impedance.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
                <div class="form-row row-cols-4" style="padding-top:10px;">
                    <div class="col-sm">
                        {{ form.vp_units.label }}
                    </div>
                    <div class="col-sm">
                        {% for field in form.vp_units %}
                        {{ field(tabindex='-1') }} {{ field.label }}
                        {% endfor %}
                    </div>
                    <div class="col-sm"></div>
                    <div class="col-sm"></div>
                </div>
            </div>
        </div>
        <!-- Wavelet parameters -->
        <div class="form-row">
            <div class="col-sm">
                <h4>Wavelet Parameters</h4>
                <div class="form-row row-cols-3">
                    <div class="col-sm">
                        {{ form.wv_type.label }}
                    </div>
                    <div class="col-sm">
                        {{ form.wv_type(id='wvType', onchange='toggleShowFApp()', tabindex='-1') }}
                    </div>
                </div>
                <div class="form-row row-cols-3">
                    <div class="col-sm">
                        {{ form.frequency.label }}
                    </div>
                    <div class="col-sm-3">
                        {{ form.frequency(class_='form-control', id='freqC', oninput='updateApparentFrequency(this)', data_toggle="tooltip", data_placement="bottom", title="Ricker: enter central frequency<br /><br />Ormsby: enter comma separated frequencies F1, F2, F3, F4") }}
                        {% for error in form.frequency.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="col-sm-3">
                        <input class="form-control-plaintext" id="freqApp" type="text" placeholder="Fapparent" tabindex='-1' readonly style="color: grey;">
                    </div>
                </div>
                <div class="form-row row-cols-3">
                    <div class="col-sm">
                        {{ form.wv_length.label }}
                    </div>
                    <div class="col-sm">
                        {{ form.wv_length(class_='form-control', id='wvLen') }}
                        {% for error in form.wv_length.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
                <div class="form-row row-cols-3">
                    <div class="col-sm">
                        {{ form.wv_dt.label }}
                    </div>
                    <div class="col-sm">
                        {{ form.wv_dt(class_='form-control', id='wvdt') }}
                        {% for error in form.wv_dt.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
                <!-- calculate button -->
                <div class="form-row">
                    <div class="col-sm"></div>
                    <div class="col-sm" style="padding-top:10px;">
                        {{ form.submit(class_='btn btn-primary') }} <a class="btn btn-outline-primary" role="button" onclick="resetForm();toggleShowFApp();">Reset</a>
                    </div>
                </div>
            </div>
            <div class="col-sm"></div>
        </div>
    </form>
{% endblock %}